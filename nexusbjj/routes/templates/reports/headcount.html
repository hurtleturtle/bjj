{% extends "base.html" %}
{% block scripts %}
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="{{ url_for('static', filename='scripts/custom001.js') }}"></script>
{% endblock %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
    {% block custom_table %}
        <div class="container nexus-table">
            <div class="rounded title py-1 my-2">
                <h1>{{ table_title }}</h1>
                {% if table_subtitle %}<h2>{{ table_subtitle }}</h2>{% endif %}
            </div>
            {% if g.user and g.user['admin'] in g.admin_levels and to_csv %}
            <div class="d-flex flex-row-reverse">
                <a class="btn btn-primary btn-download" 
                href="{{ url_for('reports.csv', report=report, start_date=start_date, end_date=end_date) }}">Download</a>
            </div>
            {% endif %}
            <table class="table">
                <thead>
                    <tr class="collapsible-3">
                        <th>Class</th>
                        <th>Attendance</th>
                        <th class="row-toggle">+</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in table_data.iterrows() %}
                        <tr class="collapsible-3">
                            <td>{{ row.Class }}</td>
                            <td>{{ row.Attendees }}</td>
                            <td id="toggle-{{ row.id }}" class="row-toggle" onclick="toggleRow('{{ row.id }}')">+</td>
                            <td id="collapsed-row-{{ row.id }}" class="expanded-3 hide-row">
                                <table class="sub-table">
                                    {% if attendance %}
                                        <tbody>
                                            {% for idx, attendee in attendance[attendance.class_id == row.id].iterrows() %}
                                                <tr {% if attendee.confirmed_by %}class="checked-in"{% endif %} 
                                                 onclick="confirmCheckIn('{{ attendee.id }}', '{{ g.user.id }}', this)">
                                                    <td>{{ attendee.full_name }}</td>
                                                    <td>{{ attendee.membership_type }}</td>
                                                    <td>{{ attendee.sessions_remaining }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    {% endif %}
                                </table>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endblock %}
{% endblock %}